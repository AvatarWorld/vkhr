# Maintainer: Erik S. V. Jansson <caffeineviking@gmail.com>

pkgname=vkhr-git
pkgver=VERSION
pkgrel=1
pkgdesc="Real-Time Hair Renderer in Vulkan"
arch=('i686' 'x86_64')
url="https://github.com/CaffeineViking/vkhr"
license=('MIT')
provides=('vkhr')
depends=('embree', 'glfw' 'vulkan-icd-loader' 'vulkan-headers')
makedepends=('git' 'premake-git')
source=('git+https://github.com/CaffeineViking/vkhr')
md5sums=('SKIP')

pkgver() {
	cd vkhr
	printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
	cd vkhr
    make download-modules
    make  config=release
}

package() {
	cd vkhr
	install -Dm755 bin/vkhr                           "$pkgdir"/usr/bin/vkhr
	install -Dm755 docs/vkhr.1                        "$pkgdir"/usr/share/man/man1/vkhr.1
	install -Dm644 license.md                         "$pkgdir"/usr/share/licenses/vkhr/LICENSE

	install -Dm644 share/images/vulkan.icon           "$pkgdir"/usr/share/vkhr/images/vulkan.icon

	install -Dm644 share/styles/wCurly.hair           "$pkgdir"/usr/share/vkhr/styles/wCurly.hair
	install -Dm644 share/styles/wStraight.hair        "$pkgdir"/usr/share/vkhr/styles/wStraight.hair
	install -Dm644 share/styles/wWavy.hair            "$pkgdir"/usr/share/vkhr/styles/wWavy.hair
	install -Dm644 share/styles/wWavyThin.hair        "$pkgdir"/usr/share/vkhr/styles/wWavyThin.hair
	install -Dm644 share/styles/ponytail.hair         "$pkgdir"/usr/share/vkhr/styles/ponytail.hair
	install -Dm644 share/styles/bear.hair             "$pkgdir"/usr/share/vkhr/styles/bear.hair

	install -Dm644 share/models/woman/eye.tga         "$pkgdir"/usr/share/vkhr/models/woman/eye.tga
	install -Dm644 share/models/woman/head.tga        "$pkgdir"/usr/share/vkhr/models/woman/head.tga
	install -Dm644 share/models/woman/woman.mtl       "$pkgdir"/usr/share/vkhr/models/woman/woman.mtl
	install -Dm644 share/models/woman/woman.obj       "$pkgdir"/usr/share/vkhr/models/woman/woman.obj
	install -Dm644 share/models/ponytail/ponytail.obj "$pkgdir"/usr/share/vkhr/models/ponytail/ponytail.obj
	install -Dm644 share/models/bear/bear.obj         "$pkgdir"/usr/share/vkhr/models/bear/bear.obj

	install -Dm644 share/shaders/kajiya-kay.vert.spv  "$pkgdir"/usr/share/vkhr/shaders/kajiya-kay.vert.spv
	install -Dm644 share/shaders/kajiya-kay.frag.spv  "$pkgdir"/usr/share/vkhr/shaders/kajiya-kay.frag.spv
	install -Dm644 share/shaders/billboards.frag.spv  "$pkgdir"/usr/share/vkhr/shaders/billboards.frag.spv
	install -Dm644 share/shaders/billboards.vert.spv  "$pkgdir"/usr/share/vkhr/shaders/billboards.vert.spv
}
